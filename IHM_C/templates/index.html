<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Interface Microcontrôleur</title>
</head>
<body>
  <div>
    <h1>PROCOM Base Roulante</h1>
  </div>

  <div id="global">
     <div style="float:left;width:40%;" id="Gauche">
      <p>Envoyer une commande au microcontrôleur :</p>
      <input id="cmd" placeholder="Commande à envoyer" onkeypress="if(event.key === 'Enter') send()">
      <button onclick="send()">Envoyer</button>
      <pre id="output"></pre>
      <script>
        async function send() {
          const command = document.getElementById('cmd').value;
          await fetch('/send', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({command})
          });
          document.getElementById('cmd').value = '';
        }

        async function readLoop() {
          const res = await fetch('/read');
          const data = await res.json();
          if (data.data) {
            document.getElementById('output').textContent += data.data + '\n';
          }
          if (data.v_mot0) {
            document.getElementById('v_mot0').textContent = data.v_mot0;
          }
          if (data.v_mot1) {
            document.getElementById('v_mot1').textContent = data.v_mot1;
          }
          setTimeout(readLoop, 500);
        }
        readLoop();
      </script>
     </div>
     <div style="float:left;width:60%;" id="Droite">
      <p>Vitesse du moteur droit : <span id="v_mot0">0</span></p>
      <p>Vitesse du moteur gauche : <span id="v_mot1">0</span></p>
      <img src="{{ url_for('static', filename='images/EAM_Nuvolari_S1_640x480.jpg') }}" />
     </div>
  </div>

  
</body>
</html>
